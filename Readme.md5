# Pacifica Groups - Guest Wi-Fi Captive Portal

à¸£à¸°à¸šà¸šà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¹à¸¥à¸°à¸¢à¸·à¸™à¸¢à¸±à¸™à¸•à¸±à¸§à¸•à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ Wi-Fi à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ (Guest Wi-Fi) à¸—à¸³à¸‡à¸²à¸™à¸£à¹ˆà¸§à¸¡à¸à¸±à¸š FortiGate Firewall à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰ Raspberry Pi à¹€à¸›à¹‡à¸™à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œà¸ªà¸³à¸«à¸£à¸±à¸šà¸«à¸™à¹‰à¸²à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™

## à¸ à¸²à¸à¸£à¸§à¸¡ (Overview)

à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸™à¸µà¹‰à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¸¶à¹‰à¸™à¹€à¸à¸·à¹ˆà¸­à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ Guest Wi-Fi à¹‚à¸”à¸¢à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ˆà¸²à¸à¸£à¸°à¸šà¸šà¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸«à¹‰à¹€à¸ˆà¹‰à¸²à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡ User à¹ƒà¸«à¹‰ à¸¡à¸²à¹€à¸›à¹‡à¸™à¸£à¸°à¸šà¸šà¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¹„à¸”à¹‰à¸”à¹‰à¸§à¸¢à¸•à¸™à¹€à¸­à¸‡ (Self-Registration) à¸œà¹ˆà¸²à¸™à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸šà¸—à¸µà¹ˆà¸ªà¸§à¸¢à¸‡à¸²à¸¡à¹à¸¥à¸°à¹€à¸›à¹‡à¸™à¹à¸šà¸£à¸™à¸”à¹Œà¸‚à¸­à¸‡à¸­à¸‡à¸„à¹Œà¸à¸£ à¹€à¸¡à¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸£à¸°à¸šà¸šà¸ˆà¸°à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸šà¸™ FortiGate Firewall à¹à¸¥à¸°à¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆ User Group à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ à¸à¸£à¹‰à¸­à¸¡à¸—à¸±à¹‰à¸‡à¸¡à¸µà¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸­à¸²à¸¢à¸¸à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹€à¸à¸·à¹ˆà¸­à¸¥à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸­à¸­à¸à¸ˆà¸²à¸ Group à¹€à¸¡à¸·à¹ˆà¸­à¸„à¸£à¸šà¸à¸³à¸«à¸™à¸”à¹€à¸§à¸¥à¸²

## à¸„à¸¸à¸“à¸ªà¸¡à¸šà¸±à¸•à¸´à¸«à¸¥à¸±à¸ (Features)

  - **Guest Self-Registration:** à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¹„à¸”à¹‰à¸”à¹‰à¸§à¸¢à¸•à¸™à¹€à¸­à¸‡à¸œà¹ˆà¸²à¸™à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸š
  - **FortiGate API Integration:** à¸ªà¸£à¹‰à¸²à¸‡à¹à¸¥à¸°à¸ˆà¸±à¸”à¸à¸²à¸£à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸šà¸™ FortiGate à¸œà¹ˆà¸²à¸™ API à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
  - **Customizable UI:** à¸«à¸™à¹‰à¸²à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¹à¸¥à¸°à¸«à¸™à¹‰à¸² Login à¸ªà¸²à¸¡à¸²à¸£à¸–à¸›à¸£à¸±à¸šà¹à¸•à¹ˆà¸‡à¹ƒà¸«à¹‰à¹€à¸‚à¹‰à¸²à¸à¸±à¸šà¹à¸šà¸£à¸™à¸”à¹Œà¸‚à¸­à¸‡à¸­à¸‡à¸„à¹Œà¸à¸£à¹„à¸”à¹‰
  - **Automatic User Expiration:** à¸¡à¸µà¸£à¸°à¸šà¸šà¸¥à¹‰à¸²à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸µà¹ˆà¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸ (12 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡) à¸­à¸­à¸à¸ˆà¸²à¸ Group à¹‚à¸”à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸œà¹ˆà¸²à¸™ Cron Job
  - **Single Device Login:** à¸ˆà¸³à¸à¸±à¸”à¹ƒà¸«à¹‰ 1 à¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸²à¸¡à¸²à¸£à¸– Login à¹„à¸”à¹‰à¸—à¸µà¸¥à¸° 1 à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
  - **Session History:** à¹€à¸à¹‡à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸§à¹‰à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ SQLite
  - **Containerized Deployment:** à¸£à¸±à¸™à¹à¸­à¸›à¸à¸¥à¸´à¹€à¸„à¸Šà¸±à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸™ Docker à¸—à¸³à¹ƒà¸«à¹‰à¸‡à¹ˆà¸²à¸¢à¸•à¹ˆà¸­à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¹à¸¥à¸°à¸¢à¹‰à¸²à¸¢à¸£à¸°à¸šà¸š

## à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¹à¸¥à¸°à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µ (Architecture & Technology Stack)

  - **Hardware:**
      - Raspberry Pi (4 or newer recommended)
      - FortiGate Firewall
  - **Software:**
      - **Host OS:** Raspberry Pi OS Lite (64-bit)
      - **Backend:** Python 3 + Flask
      - **Web Server / Proxy:** Nginx
      - **Database:** SQLite 3
      - **Containerization:** Docker & Docker Compose

## ğŸš€ à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ (Installation Guide)

### 1\. à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸šà¸™ FortiGate Firewall

1.  **à¸ªà¸£à¹‰à¸²à¸‡ REST API Admin:**
      - à¹„à¸›à¸—à¸µà¹ˆ `System > Administrators` \> `Create New > REST API Admin`
      - à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Profile à¹ƒà¸«à¹‰à¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œ `Read-Write` à¹ƒà¸™à¸ªà¹ˆà¸§à¸™à¸‚à¸­à¸‡ `User & Device`
      - à¸ˆà¸³à¸à¸±à¸” IP Address à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸‚à¸­à¸‡ Raspberry Pi à¹à¸¥à¸°à¸„à¸±à¸”à¸¥à¸­à¸ **API Key** à¹€à¸à¹‡à¸šà¹„à¸§à¹‰
2.  **à¸ªà¸£à¹‰à¸²à¸‡ User Group:**
      - à¹„à¸›à¸—à¸µà¹ˆ `User & Authentication > User Groups` \> `Create New`
      - **Name:** `Guest-Group`
      - **Type:** `Firewall`
3.  **à¸ªà¸£à¹‰à¸²à¸‡ Address Objects:**
      - à¹„à¸›à¸—à¸µà¹ˆ `Policy & Objects > Addresses` \> `Create New`
      - à¸ªà¸£à¹‰à¸²à¸‡ Object à¸ªà¸³à¸«à¸£à¸±à¸š Raspberry Pi (à¹€à¸Šà¹ˆà¸™ `Portal_Server_RPi`), DNS (à¹€à¸Šà¹ˆà¸™ `Google_DNS`), à¹à¸¥à¸° FQDN à¸ªà¸³à¸«à¸£à¸±à¸š Apple/Google Captive Check
4.  **à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Interface à¸ªà¸³à¸«à¸£à¸±à¸š Guest:**
      - à¹„à¸›à¸—à¸µà¹ˆ `Network > Interfaces` à¹à¸¥à¹‰à¸§à¹à¸à¹‰à¹„à¸‚ VLAN Interface à¸‚à¸­à¸‡ Guest
      - **Security mode:** `Captive Portal`
      - **Authentication portal:** `Local`
      - **Exempt destinations/services:** à¹€à¸à¸´à¹ˆà¸¡ Address Object à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸™à¸‚à¹‰à¸­ 3
5.  **à¸ªà¸£à¹‰à¸²à¸‡ Firewall Policies:**
      - **Policy 1 (Pre-Auth):**
          - `Incoming`: `VLAN GUEST`, `Outgoing`: `any`
          - `Source`: `all`
          - `Destination`: `Portal_Server_RPi`, `Google_DNS`, à¹à¸¥à¸° FQDN Objects
          - `Action`: `ACCEPT`, `NAT`: `Enabled`, `User`: **(à¸›à¸¥à¹ˆà¸­à¸¢à¸§à¹ˆà¸²à¸‡)**
      - **Policy 2 (Post-Auth):**
          - `Incoming`: `VLAN GUEST`, `Outgoing`: `wan1`
          - `Source`: `all`
          - `Destination`: `all`
          - `Action`: `ACCEPT`, `NAT`: `Enabled`, `User`: `Guest-Group`
      - **à¸¥à¸³à¸”à¸±à¸š:** Policy 1 à¸•à¹‰à¸­à¸‡à¸­à¸¢à¸¹à¹ˆà¹€à¸«à¸™à¸·à¸­ Policy 2
6.  **à¸›à¸£à¸±à¸šà¹à¸•à¹ˆà¸‡à¸«à¸™à¹‰à¸² Login:**
      - à¹„à¸›à¸—à¸µà¹ˆ `System > Replacement Messages` \> `Firewall Authentication` \> `Login Page`
      - à¹à¸à¹‰à¹„à¸‚à¹‚à¸„à¹‰à¸” HTML à¹€à¸à¸·à¹ˆà¸­à¹€à¸à¸´à¹ˆà¸¡à¸›à¸¸à¹ˆà¸¡/à¸¥à¸´à¸‡à¸à¹Œà¸ªà¸³à¸«à¸£à¸±à¸š Register à¹„à¸›à¸¢à¸±à¸‡ `http://<IP_RASPBERRY_PI>/register`
7.  **à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² 1 User/Device (CLI):**
    ```
    config user setting
        set auth-concurrent-override enable
        set auth-concurrent-value 1
    end
    ```

### 2\. à¸à¸²à¸£à¹€à¸•à¸£à¸µà¸¢à¸¡ Raspberry Pi

```bash
# à¸­à¸±à¸›à¹€à¸”à¸•à¸£à¸°à¸šà¸š
sudo apt update && sudo apt upgrade -y
# à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker ${USER}
# à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Docker Compose Plugin à¹à¸¥à¸°à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¸­à¸·à¹ˆà¸™à¹†
sudo apt install -y python3-pip docker-compose-plugin
# Logout à¹à¸¥à¹‰à¸§ Login à¹ƒà¸«à¸¡à¹ˆà¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸ªà¸´à¸—à¸˜à¸´à¹Œ docker à¸¡à¸µà¸œà¸¥
```

### 3\. à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œ

1.  à¸™à¸³à¹„à¸Ÿà¸¥à¹Œà¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹„à¸›à¸§à¸²à¸‡à¸—à¸µà¹ˆ `~/pacifica-wifi` à¸šà¸™ Raspberry Pi
2.  **à¹à¸à¹‰à¹„à¸‚à¸„à¹ˆà¸²à¸„à¸­à¸™à¸Ÿà¸´à¸:**
      - à¹€à¸›à¸´à¸”à¹„à¸Ÿà¸¥à¹Œ `~/pacifica-wifi/app/main.py` à¹à¸¥à¸° `~/pacifica-wifi/app/cleanup.py`
      - à¹à¸à¹‰à¹„à¸‚à¸„à¹ˆà¸² `FORTIGATE_IP` à¹à¸¥à¸° `FORTIGATE_API_KEY` à¹ƒà¸«à¹‰à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

### 4\. à¸à¸²à¸£à¸£à¸±à¸™à¹à¸­à¸›à¸à¸¥à¸´à¹€à¸„à¸Šà¸±à¸™à¸”à¹‰à¸§à¸¢ Docker

```bash
# à¹€à¸‚à¹‰à¸²à¹„à¸›à¸—à¸µà¹ˆà¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œà¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œ
cd ~/pacifica-wifi
# à¸ªà¸±à¹ˆà¸‡ Build à¹à¸¥à¸° Run
docker compose up --build -d
```

### 5\. à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸šà¸¥à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸ (Cron Job)

```bash
# à¹€à¸›à¸´à¸” crontab editor
crontab -e
# à¹€à¸à¸´à¹ˆà¸¡à¸šà¸£à¸£à¸—à¸±à¸”à¸™à¸µà¹‰à¸—à¸µà¹ˆà¸—à¹‰à¸²à¸¢à¹„à¸Ÿà¸¥à¹Œà¹€à¸à¸·à¹ˆà¸­à¸£à¸±à¸™à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸—à¸¸à¸à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡
0 * * * * /usr/bin/python3 /home/pacifica/pacifica-wifi/app/cleanup.py >> /home/pacifica/pacifica-wifi/cleanup.log 2>&1
```

## à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ (Project Structure)

```
pacifica-wifi/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ register.html
â”‚   â”‚   â”œâ”€â”€ registered.html
â”‚   â”‚   â””â”€â”€ base.html
â”‚   â”œâ”€â”€ main.py         # à¹à¸­à¸›à¸à¸¥à¸´à¹€à¸„à¸Šà¸±à¸™à¸«à¸¥à¸±à¸ (Flask)
â”‚   â”œâ”€â”€ cleanup.py      # à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸¥à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸
â”‚   â”œâ”€â”€ guests.db       # à¹„à¸Ÿà¸¥à¹Œà¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ SQLite
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â””â”€â”€ nginx/
    â””â”€â”€ nginx.conf
```

## à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¸›à¸±à¸à¸«à¸² (Troubleshooting)

  - **à¸”à¸¹ Log à¸‚à¸­à¸‡à¹à¸­à¸›à¸à¸¥à¸´à¹€à¸„à¸Šà¸±à¸™:** `docker logs -f pacifica_webapp`
  - **à¸«à¸¢à¸¸à¸”à¹à¸¥à¸°à¸¥à¸š Container:** `docker compose down`
  - **à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸° Container:** `docker ps -a`
